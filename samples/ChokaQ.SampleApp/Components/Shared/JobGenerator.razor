@using System.Net.Http
@using System.Net.Http.Json
@inject IHttpClientFactory HttpClientFactory
@inject NavigationManager Navigation

<div class="card bg-dark text-white border-secondary mb-4 shadow-sm">
    <div class="card-header border-secondary d-flex justify-content-between align-items-center">
        <h5 class="mb-0">🏭 Workload Generator</h5>
    </div>
    <div class="card-body d-flex gap-3 align-items-end">
        <div class="flex-grow-1">
            <label class="form-label text-secondary small">Batch Size</label>
            <select class="form-select bg-dark text-white border-secondary" @bind="selectedCount">
                @for (int i = 10; i <= 100; i += 10)
                {
                    <option value="@i">@i Items</option>
                }
            </select>
        </div>

        <button class="btn btn-primary" @onclick="SendBatch" disabled="@isLoading">
            @if (isLoading)
            {
                <span class="spinner-border spinner-border-sm me-2"></span>
                <span>Uploading...</span>
            }
            else
            {
                <span>🚀 Send Batch</span>
            }
        </button>
    </div>
</div>

<button @onclick="() => Console.WriteLine(123123)">Test Click</button>

@code {
    private int selectedCount = 10;
    private bool isLoading = false;

    private async Task SendBatch()
    {
        isLoading = true;
        try
        {
            var client = HttpClientFactory.CreateClient();
            client.BaseAddress = new Uri(Navigation.BaseUri);

            // Client-side data generation.
            // We simulate a real client creating specific requests.
            var payloads = Enumerable.Range(1, selectedCount)
                .Select(i => $"Order #{Random.Shared.Next(1000, 9999)} processed at {DateTime.Now:T}")
                .ToList();

            await client.PostAsJsonAsync("/api/jobs/batch", payloads);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}