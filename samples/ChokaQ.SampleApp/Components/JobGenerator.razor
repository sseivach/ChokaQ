@using System.Net.Http
@using System.Net.Http.Json
@inject IHttpClientFactory HttpClientFactory
@inject NavigationManager Navigation

<div class="card bg-dark text-white border-secondary mb-4 shadow-sm">
    <div class="card-header border-secondary d-flex justify-content-between align-items-center">
        <h5 class="mb-0">🎮 Job Generator</h5>
    </div>
    <div class="card-body d-flex gap-3 align-items-end">
        <div class="flex-grow-1">
            <label class="form-label text-secondary small">Count (10-100)</label>
            <select class="form-select bg-dark text-white border-secondary" @bind="selectedCount">
                @for (int i = 10; i <= 100; i += 10)
                {
                    <option value="@i">@i Jobs</option>
                }
            </select>
        </div>

        <button class="btn btn-primary" @onclick="LaunchJobs" disabled="@isLoading">
            @if (isLoading)
            {
                <span class="spinner-border spinner-border-sm me-2"></span>
                <span>Firing...</span>
            }
            else
            {
                <span>🚀 Launch</span>
            }
        </button>
    </div>
</div>

@code {
    private int selectedCount = 10;
    private bool isLoading = false;

    private async Task LaunchJobs()
    {
        isLoading = true;
        try
        {
            var client = HttpClientFactory.CreateClient();
            client.BaseAddress = new Uri(Navigation.BaseUri);

            var response = await client.PostAsJsonAsync("/api/simulation/bulk", selectedCount);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}