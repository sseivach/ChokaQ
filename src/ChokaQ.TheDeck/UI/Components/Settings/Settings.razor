@using ChokaQ.Abstractions
@using ChokaQ.Abstractions.Workers
@namespace ChokaQ.TheDeck.UI.Components.Settings

<section class="settings">
    <div class="settings__grid">
        <!-- Left Column: Engine settings -->
        <div class="settings__col">
            <div class="settings__row">
                <label class="settings__label">MAX WORKERS</label>
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                    <input type="number" class="settings__input" min="0" max="100" @bind="DesiredWorkers" />
                    <span class="settings__info" style="@(WorkerManager.ActiveWorkers > 0 ? "color: var(--deck-success); font-weight: bold; opacity: 1;" : "")">
                        (Busy: @WorkerManager.ActiveWorkers)
                    </span>
                </div>
            </div>

            <div class="settings__row">
                <label class="settings__label">MAX RETRIES</label>
                <select class="settings__select" @bind="MaxRetries">
                    @for (int i = 1; i <= 10; i++)
                    {
                        <option value="@i">@i</option>
                    }
                </select>
            </div>

            <div class="settings__row">
                <label class="settings__label">RETRY DELAY (S)</label>
                <input type="number" class="settings__input" min="1" max="3600" @bind="RetryDelaySeconds" />
            </div>

            <div class="settings__actions">
                <button class="deck-btn deck-btn-success" @onclick="ApplyChanges">
                    APPLY
                </button>
            </div>
        </div>

        <div class="settings__divider"></div>

        <!-- Right Column: History maintenance -->
        <div class="settings__col">
            <div class="settings__row">
                <label class="settings__label">ARCHIVE HISTORY (D)</label>
                <input type="number" class="settings__input" min="1" max="365" @bind="_archiveRetentionDays" />
            </div>
            <div class="settings__actions">
                <button class="deck-btn deck-btn-danger" @onclick="PurgeArchiveAsync" disabled="@_isPurgingArchive">
                    @(_isPurgingArchive ? "..." : "PURGE ARCHIVE")
                </button>
            </div>

            <div class="settings__row" style="margin-top: 1rem;">
                <label class="settings__label">DLQ HISTORY (D)</label>
                <input type="number" class="settings__input" min="1" max="365" @bind="_dlqRetentionDays" />
            </div>
            <div class="settings__actions">
                <button class="deck-btn deck-btn-danger" @onclick="PurgeDLQAsync" disabled="@_isPurgingDLQ">
                    @(_isPurgingDLQ ? "..." : "PURGE DLQ")
                </button>
            </div>
        </div>
    </div>
</section>
