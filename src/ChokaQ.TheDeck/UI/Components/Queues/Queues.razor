@using ChokaQ.Abstractions.Entities
@namespace ChokaQ.TheDeck.UI.Components.Queues
@implements IDisposable

<section class="queues">
    @if (_isLoading)
    {
        <div class="queues__loading">
            <span>Loading queues...</span>
        </div>
    }
    else if (!_visibleQueues.Any())
    {
        <div class="queues__empty">
             <span>No queues found. Send a job to 'default' queue to see it here.</span>
        </div>
    }
    else
    {
        <table class="deck-table queues__table">
            <thead>
                <tr>
                    <th class="queues__th queues__th--name">Queue</th>
                    <th class="queues__th queues__th--stats">Jobs (Succeeded / Failed)</th>
                    <th class="queues__th queues__th--status">Status</th>
                    <th class="queues__th queues__th--toggle">Pause / Resume</th>
                    <th class="queues__th queues__th--timeout">Zombie (s)</th>
                    <th class="queues__th queues__th--reserv1">Reserv 1</th>
                    <th class="queues__th queues__th--reserv2">Reserv 2</th>
                    <th class="queues__th queues__th--updated">Last Updated</th>
                    <th class="queues__th queues__th--actions">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var q in _visibleQueues)
                {
                    var stats = GetQueueStats(q.Name);
                    <tr>
                        <td class="queues__name">@q.Name</td>
                        <td class="queues__stats">
                            @if (stats != null)
                            {
                                <span class="queues__stats-succeeded">@stats.SucceededTotal.ToString("N0")</span>
                                <span class="queues__stats-sep">/</span>
                                <span class="queues__stats-failed">@stats.FailedTotal.ToString("N0")</span>
                            }
                            else
                            {
                                <span class="queues__stats-empty">0 / 0</span>
                            }
                        </td>
                        <td class="queues__status-cell">
                             <span class="queues__status @GetStatusModifier(q)">
                                 @GetQueueStatus(q)
                             </span>
                        </td>
                        <td class="queues__toggle-cell">
                             <input type="checkbox" 
                                    class="queues__toggle"
                                    checked="@(!q.IsPaused)"
                                    @onchange="@(e => ToggleQueue(q.Name, (bool)e.Value!))" />
                        </td>
                        <td class="queues__timeout-cell">
                            <input type="number"
                                   class="queues__timeout-input"
                                   value="@q.ZombieTimeoutSeconds"
                                   @onchange="@(e => UpdateTimeout(q.Name, e.Value))" />
                        </td>
                        <td class="queues__reserv1-cell">---</td>
                        <td class="queues__reserv2-cell">---</td>
                        <td class="queues__updated">
                            @q.LastUpdatedUtc.ToLocalTime().ToString("HH:mm:ss")
                        </td>
                        <td class="queues__actions">
                            <button class="deck-btn queues__action-btn" title="Hide queue" @onclick="() => HideQueue(q.Name)">HIDE</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</section>
