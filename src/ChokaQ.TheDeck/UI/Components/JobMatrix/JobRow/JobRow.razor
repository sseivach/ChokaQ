@using ChokaQ.Abstractions.Enums
@namespace ChokaQ.TheDeck.UI.Components.JobMatrix.JobRow

<tr class="job-row @(IsSelected ? "job-row--selected" : "")" @onclick="HandleRowClick">
    <td class="job-row__cell job-row__cell--checkbox" @onclick:stopPropagation="true">
        <input type="checkbox" class="job-row__checkbox" checked="@IsSelected" @onchange="HandleCheckboxChange" />
    </td>
    
    <td class="job-row__cell job-row__cell--id" title="@Job.Id">
        @Job.Id
    </td>
    
    <td class="job-row__cell job-row__cell--queue">
        <span class="job-row__badge job-row__badge--queue">
            @Job.Queue
        </span>
    </td>
    
    <td class="job-row__cell job-row__cell--type">
        <span class="job-row__badge job-row__badge--type">
            @Job.Type
        </span>
    </td>
    
    <td class="job-row__cell job-row__cell--priority">
        @Job.Priority
    </td>
    
    <td class="job-row__cell job-row__cell--author">
        @(Job.CreatedBy ?? "System")
    </td>
    
    <td class="job-row__cell job-row__cell--status">
        <span class="job-row__status @GetStatusModifier()">@GetStatusLabel()</span>
    </td>
    
    <td class="job-row__cell job-row__cell--progress">
        @if (Job.Status == JobStatus.Processing)
        {
             <div class="deck-progress">
                 <div class="deck-progress-bar job-row__progress-bar--processing" style="width: @(Job.Progress)%;"></div>
             </div>
             <div class="job-row__progress-text">@Job.Progress%</div>
        }
        else if (Job.Status == JobStatus.Succeeded)
        {
             <div class="deck-progress">
                 <div class="deck-progress-bar job-row__progress-bar--succeeded" style="width: 100%;"></div>
             </div>
        }
        else
        {
            <span class="job-row__cell--empty">-</span>
        }
    </td>
    
    <td class="job-row__cell job-row__cell--attempts">
        @if (Job.Attempts > 1)
        {
            <span class="job-row__badge job-row__badge--attempts">@Job.Attempts</span>
        }
        else
        {
             <span class="job-row__cell--dim">1</span>
        }
    </td>
    
    <td class="job-row__cell job-row__cell--duration">
        @FormatDuration(Job.Duration)
    </td>
    
    <td class="job-row__cell job-row__cell--actions">
        @if (new[] { JobStatus.Processing, JobStatus.Pending, JobStatus.Fetched }.Contains(Job.Status))
        {
             <button class="deck-btn deck-btn-danger job-row__action-btn" @onclick="CancelJob" @onclick:stopPropagation="true">Stop</button>
        }
        @if (new[] { JobStatus.Succeeded, JobStatus.Failed, JobStatus.Cancelled }.Contains(Job.Status))
        {
             <button class="deck-btn deck-btn-primary job-row__action-btn" @onclick="RestartJob" @onclick:stopPropagation="true">Retry</button>
        }
    </td>
</tr>
