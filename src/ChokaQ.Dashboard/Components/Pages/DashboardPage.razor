@using ChokaQ.Dashboard.Components.Features
@using ChokaQ.Dashboard.Components.Shared
@using ChokaQ.Dashboard.Models
@using Microsoft.AspNetCore.Components.Web

<div class="cq-dashboard @CurrentThemeClass">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex align-items-baseline gap-3">
            <h5 class="mb-0 fw-bold">CHOKAQ MONITORING</h5>
            <small style="color: var(--cq-text-muted)">v1.0.0</small>
        </div>

        <div class="d-flex align-items-center gap-2">
            <span class="small fw-bold" style="color: var(--cq-text-muted)">THEME</span>
            <select class="form-select form-select-sm cq-select" style="width: 160px;"
                    value="@_currentTheme"
                    @onchange="@(e => HandleThemeChanged(e.Value?.ToString() ?? "office"))">
                <option value="office">Return to Office</option>
                <option value="nightshift">Night Shift</option>
                <option value="caviar">Black Caviar</option>
                <option value="flashbang">Flashbang</option>
                <option value="kiddie">Script Kiddie</option>
                <option value="bsod">Blue Screen</option>
                <option value="bravosix">Bravo Six</option>
                <option value="carbon">Carbon</option>
                <option value="async">Async</option>
            </select>
        </div>
    </div>

    @* Summary Metrics *@
    <div class="metrics-grid mb-4">
        <div class="metric-card">
            <div class="metric-label">Pending</div>
            <div class="metric-value small font-mono">@_counts.Pending.ToString("N0")</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Processing</div>
            <div class="metric-value small font-mono">@_counts.Processing.ToString("N0")</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Succeeded</div>
            <div class="metric-value small font-mono" style="color: var(--cq-success)">@_counts.SucceededTotal.ToString("N0")</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Failed</div>
            <div class="metric-value small font-mono" style="color: var(--cq-danger)">@_counts.FailedTotal.ToString("N0")</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Total Jobs</div>
            <div class="metric-value small font-mono">@_counts.Total.ToString("N0")</div>
        </div>
    </div>

    <QueueManager HubConnection="_hubConnection" />
    <CircuitMonitor @ref="_circuitMonitor" />
    <DashboardSettings OnSettingsApplied="HandleSettingsUpdated" />

    <JobFeed Jobs="_jobs"
             Counts="_counts"
             IsConnected="IsConnected"
             HubConnection="_hubConnection"
             OnClearHistory="ClearHistory" />
</div>