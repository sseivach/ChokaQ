<div class="card cq-card shadow-sm mb-4">
    <div class="card-header py-2 d-flex justify-content-between align-items-center"
         style="background-color: var(--cq-panel-bg); border-bottom: 1px solid var(--cq-border);">
        <div class="d-flex align-items-center gap-2">
            <h6 class="mb-0 fw-bold small text-uppercase" style="color: var(--cq-text-muted)">
                Queue Configuration
            </h6>
            @if (_queues.Any())
            {
                <span class="badge bg-secondary rounded-pill" style="font-size: 0.65rem;">@_visibleQueues.Count()</span>
            }
        </div>

        @if (_hiddenQueues.Any())
        {
            <button class="btn btn-sm btn-link text-decoration-none small p-0"
                    style="font-size: 0.75rem;"
                    @onclick="ShowAllQueues">
                Show Hidden (@_hiddenQueues.Count)
            </button>
        }
    </div>

    <div class="table-responsive">
        @if (!_queues.Any())
        {
            <div class="p-4 text-center text-muted small">
                @if (_isLoading)
                {
                    <span>Loading queues...</span>
                }
                else
                {
                    <span>No queues found. Send a job to 'default' queue to see it here.</span>
                }
            </div>
        }
        else
        {
            <table class="table mb-0 text-nowrap" style="color: var(--cq-text); font-size: 0.75rem;">
                <thead style="background-color: rgba(0,0,0,0.02); text-transform: uppercase;">
                    <tr>
                        <th class="ps-3" style="width: 20%">Queue</th>
                        <th class="text-center" style="width: 20%">Jobs (P/F/R | S/F)</th>
                        <th class="text-center" style="width: 12%">Status</th>
                        <th class="text-center" style="width: 12%">Pause/Resume</th>
                        <th class="text-center" style="width: 15%">Zombie Timeout (s)</th>
                        <th class="text-end" style="width: 16%">Last Updated</th>
                        <th class="text-end pe-3" style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var q in _visibleQueues)
                    {
                        var stats = GetQueueStats(q.Name);
                        <tr style="border-bottom: 1px solid var(--cq-border); transition: background-color 0.3s;">

                            <td class="ps-3 align-middle">
                                <span class="fw-bold font-monospace">@q.Name</span>
                            </td>

                            <td class="align-middle text-center font-monospace" style="font-size: 0.7rem;">
                                @if (stats != null)
                                {
                                    var active = stats.Pending + stats.Fetched + stats.Processing;
                                    <span title="Pending/Fetched/Processing | Succeeded/Failed">
                                        <span style="color: var(--cq-info)">@stats.Pending</span>/<span style="color: var(--cq-warning)">@stats.Fetched</span>/<span style="color: var(--cq-accent)">@stats.Processing</span>
                                        <span class="mx-1">|</span>
                                        <span style="color: var(--cq-success)">@stats.SucceededTotal.ToString("N0")</span>/<span style="color: var(--cq-danger)">@stats.FailedTotal.ToString("N0")</span>
                                    </span>
                                }
                                else
                                {
                                    <span class="text-muted">0/0/0 | 0/0</span>
                                }
                            </td>

                            <td class="align-middle text-center">
                                <span class="badge" style="font-size: 0.7em; background-color: @GetStatusColor(q);">
                                    @GetQueueStatus(q)
                                </span>
                            </td>

                            <td class="align-middle text-center">
                                <div class="form-check form-switch d-inline-block" style="min-height: 0;">
                                    <input class="form-check-input" type="checkbox"
                                           style="width: 2.5em; height: 1.2em; margin-top: 0;"
                                           id="q_@q.Name"
                                           checked="@(!q.IsPaused)"
                                           @onchange="@(e => ToggleQueue(q.Name, (bool)e.Value!))">
                                </div>
                            </td>

                            <td class="align-middle text-center">
                                <input type="number"
                                       class="form-control form-control-sm cq-input text-center mx-auto"
                                       style="height: 26px; font-size: 0.75rem; width: 100px;"
                                       placeholder="Global (600)"
                                       value="@q.ZombieTimeoutSeconds"
                                       @onchange="@(e => UpdateTimeout(q.Name, e.Value))" />
                            </td>

                            <td class="align-middle text-end text-muted">
                                <span>@q.LastUpdatedUtc.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</span>
                            </td>

                            <td class="pe-3 text-end align-middle">
                                @if (!q.IsActive)
                                {
                                    <button class="btn btn-sm btn-link text-decoration-none text-muted p-0"
                                            title="Hide inactive queue"
                                            @onclick="() => HideQueue(q.Name)">
                                        X
                                    </button>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>
