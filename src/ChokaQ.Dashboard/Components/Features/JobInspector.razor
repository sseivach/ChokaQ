@using ChokaQ.Dashboard.Models
@namespace ChokaQ.Dashboard.Components.Features

@if (IsVisible)
{
    <div class="inspector-backdrop" @onclick="Close"></div>
}

<div class="inspector-panel shadow-lg @(IsVisible ? "open" : "")">
    @if (Job == null)
    {
        <div class="p-4 text-center text-muted">
            <p>No job selected</p>
        </div>
    }
    else
    {
        <div class="inspector-header">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h5 class="mb-1">Job Details</h5>
                    <div class="font-monospace small text-muted">@Job.Id</div>
                </div>
                <button type="button" class="btn-close" @onclick="Close"></button>
            </div>

            <div class="mt-3 d-flex gap-2 align-items-center">
                <span class="badge bg-@Job.StatusColor">
                    <i class="bi @Job.StatusIcon me-1"></i> @Job.Status
                </span>
                <span class="badge bg-light text-dark border">
                    Queue: @Job.Queue
                </span>
                <span class="badge bg-light text-dark border">
                    Try: @Job.AttemptCount
                </span>
            </div>
        </div>

        <div class="inspector-body">
            <div class="mb-4">
                <h6 class="text-uppercase small fw-bold text-muted mb-2">Payload (JSON)</h6>
                <div class="code-block">
                    @if (string.IsNullOrEmpty(Job.Payload))
                    {
                        <span class="text-muted fst-italic">No payload data</span>
                    }
                    else
                    {
                        <code>@Job.Payload</code>
                    }
                </div>
            </div>

            @if (!string.IsNullOrEmpty(Job.ErrorDetails))
            {
                <div class="mb-4">
                    <h6 class="text-uppercase small fw-bold text-danger mb-2">Error Details</h6>
                    <div class="code-block border-danger bg-danger bg-opacity-10 text-danger">
                        <code>@Job.ErrorDetails</code>
                    </div>
                </div>
            }

            <div class="row g-3 small text-muted">
                <div class="col-6">
                    <div class="fw-bold">Created</div>
                    <div>@(Job.CreatedAt?.ToLocalTime().ToString("G") ?? "-")</div>
                </div>
                <div class="col-6">
                    <div class="fw-bold">Finished</div>
                    <div>@(Job.FinishedAt?.ToLocalTime().ToString("G") ?? "-")</div>
                </div>
                <div class="col-6">
                    <div class="fw-bold">Duration</div>
                    <div>@(Job.DurationMs.HasValue ? $"{Job.DurationMs:F0} ms" : "-")</div>
                </div>
                <div class="col-6">
                    <div class="fw-bold">User</div>
                    <div>@(Job.CreatedBy ?? "System")</div>
                </div>
            </div>
        </div>

        <div class="inspector-footer">
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                @if (Job.Status == ChokaQ.Abstractions.Enums.JobUIStatus.Morgue)
                {
                    <button class="btn btn-outline-success" @onclick="Restart">
                        <i class="bi bi-heart-pulse me-1"></i> Resurrect
                    </button>
                }

                <button class="btn btn-outline-danger" @onclick="Delete">
                    <i class="bi bi-trash me-1"></i> Delete Forever
                </button>
            </div>
        </div>
    }
</div>

<style>
    /* Backdrop */
    .inspector-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.3);
        z-index: 1040;
        animation: fadeIn 0.2s;
    }

    /* Panel */
    .inspector-panel {
        position: fixed;
        top: 0;
        right: 0;
        width: 100%;
        max-width: 500px;
        height: 100vh;
        background: var(--cq-panel-bg, #fff);
        z-index: 1050;
        border-left: 1px solid var(--cq-border, #dee2e6);
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        display: flex;
        flex-direction: column;
    }

        .inspector-panel.open {
            transform: translateX(0);
        }

    /* Sections */
    .inspector-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--cq-border, #dee2e6);
    }

    .inspector-body {
        padding: 1.5rem;
        flex: 1;
        overflow-y: auto;
    }

    .inspector-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--cq-border, #dee2e6);
        background: var(--cq-bg, #f8f9fa);
    }

    /* Code Block */
    .code-block {
        background: #f1f3f5;
        padding: 1rem;
        border-radius: 6px;
        font-family: var(--bs-font-monospace, monospace);
        font-size: 0.85rem;
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-all;
        border: 1px solid var(--cq-border, #dee2e6);
    }
</style>