@using ChokaQ.Dashboard.Models
@using ChokaQ.Abstractions.Enums

<tr class="cq-job-row @(IsSelected ? "selected-row" : "")" @onclick="HandleRowClick">

    <td class="text-center" @onclick:stopPropagation="true">
        <input type="checkbox"
               class="form-check-input darker-border-checkbox"
               checked="@IsSelected"
               @onchange="HandleCheckboxChange" />
    </td>

    <td class="font-monospace fw-bold" style="color: var(--cq-info); font-size: 0.85rem;" title="@Job.Id">
        @Job.Id.Substring(0, 8)...
    </td>

    <td>
        <span class="badge bg-light text-dark border font-monospace">
            @Job.Queue
        </span>
    </td>

    <td>
        <span class="badge bg-dark border border-secondary text-light font-monospace">
            @Job.Type
        </span>
    </td>

    <td class="text-center fw-bold text-muted">
        @Job.Priority
    </td>

    <td>
        <span class="fw-bold small" style="color: var(--cq-text-muted)">
            @(Job.CreatedBy ?? "System")
        </span>
    </td>

    <td>
        <span class="badge bg-@Job.StatusColor text-uppercase">
            <i class="bi @Job.StatusIcon me-1"></i> @Job.Status
        </span>
    </td>

    <td class="font-monospace small">
        @if (Job.DurationMs.HasValue)
        {
            <span>@(Job.DurationMs.Value.ToString("N0")) ms</span>
        }
        else if (Job.Status == JobUIStatus.Processing)
        {
            <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Running...</span>
            </div>
        }
        else
        {
            <span class="text-muted">-</span>
        }
    </td>

    <td>
        @if (Job.AttemptCount > 1)
        {
            <span class="badge border border-secondary text-dark">@Job.AttemptCount</span>
        }
        else
        {
            <span class="text-muted small">1</span>
        }
    </td>

    <td class="small text-muted">
        @if (Job.FinishedAt.HasValue)
        {
            <span>@Job.FinishedAt.Value.ToLocalTime().ToString("HH:mm:ss")</span>
        }
        else if (Job.CreatedAt.HasValue)
        {
            <span>@Job.CreatedAt.Value.ToLocalTime().ToString("HH:mm:ss")</span>
        }
    </td>

    <td class="text-end">
        @if (Job.Status == JobUIStatus.Processing || Job.Status == JobUIStatus.Pending || Job.Status == JobUIStatus.Retrying)
        {
            <button class="btn btn-sm btn-outline-danger me-2"
                    title="Stop Job"
                    @onclick="CancelJob"
                    @onclick:stopPropagation="true">
                🛑
            </button>
        }

        @if (Job.Status == JobUIStatus.Succeeded || Job.Status == JobUIStatus.Morgue || Job.Status == JobUIStatus.Cancelled)
        {
            <button class="btn btn-sm btn-outline-primary me-2"
                    title="Restart Job"
                    @onclick="RestartJob"
                    @onclick:stopPropagation="true">
                🔄
            </button>
        }
    </td>
</tr>

<style>
    .cq-job-row {
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .selected-row td {
        background-color: rgba(0, 120, 212, 0.1) !important;
    }
</style>