@using ChokaQ.Abstractions.Enums

<tr class="cq-job-row @(IsSelected ? "selected-row" : "")" @onclick="HandleRowClick">

    <td class="text-center" @onclick:stopPropagation="true">
        <input type="checkbox"
               class="form-check-input darker-border-checkbox"
               checked="@IsSelected"
               @onchange="HandleCheckboxChange" />
    </td>

    <td class="font-monospace fw-bold" style="color: var(--cq-info); font-size: 0.85rem;"
        title="@Job.Id">
        @Job.Id.Substring(0, 8)...
    </td>

    <td>
        <span class="badge bg-light text-dark border font-monospace">
            @Job.Queue
        </span>
    </td>

    <td>
        <span class="badge bg-dark border border-secondary text-light font-monospace">
            @Job.Type
        </span>
    </td>

    <td class="text-center fw-bold text-muted">
        @Job.Priority
    </td>

    <td>
        <span class="fw-bold small" style="color: var(--cq-text-muted)">
            @(Job.CreatedBy ?? "System")
        </span>
    </td>

    <td>
        @if (Job.Status == JobStatus.Fetched)
        {
            <span class="badge" style="background-color: #6f42c1; color: white;">FETCHED</span>
        }
        else
        {
            <span class="badge @GetStatusBadgeClass()">
                @GetStatusLabel()
            </span>
        }
    </td>

    <td>
        @if (Job.Status == JobStatus.Processing)
        {
            <div class="progress" style="height: 4px; background-color: var(--cq-border);">
                <div class="progress-bar" role="progressbar"
                     style="width: @(Job.Progress)%; background-color: var(--cq-info);
                         transition: width 0.3s ease;">
                </div>
            </div>
            <div style="font-size: 0.7em; margin-top: 2px;">@Job.Progress%</div>
        }
        else if (Job.Status == JobStatus.Succeeded)
        {
            <div class="progress" style="height: 4px; background-color: var(--cq-border);">
                <div class="progress-bar" style="width: 100%; background-color: var(--cq-success);"></div>
            </div>
        }
        else
        {
            <span style="color: var(--cq-text-muted)">-</span>
        }
    </td>

    <td>
        @if (Job.Attempts > 1)
        {
            <span class="badge" style="border: 1px solid var(--cq-border); color: var(--cq-text);">@Job.Attempts</span>
        }
        else
        {
            <span style="color: var(--cq-text-muted)">1</span>
        }
    </td>

    <td class="font-monospace small">
        @FormatDuration(Job.Duration)
    </td>

    <td class="text-end">
        @if (Job.Status == JobStatus.Processing || Job.Status == JobStatus.Pending || Job.Status == JobStatus.Fetched)
        {
            <button class="btn btn-sm btn-outline-danger me-2"
                    title="Stop Job"
                    @onclick="CancelJob"
                    @onclick:stopPropagation="true">
                Stop
            </button>
        }

        @if (Job.Status == JobStatus.Succeeded || Job.Status == JobStatus.Failed || Job.Status == JobStatus.Cancelled)
        {
            <button class="btn btn-sm btn-outline-primary me-2"
                    title="Restart Job"
                    @onclick="RestartJob"
                    @onclick:stopPropagation="true">
                Retry
            </button>
        }
    </td>
</tr>

<style>
    .cq-job-row {
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .selected-row td {
        background-color: rgba(0, 120, 212, 0.1) !important;
    }
</style>