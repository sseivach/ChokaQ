@using ChokaQ.Abstractions.Enums

<tr class="cq-job-row @(IsSelected ? "selected-row" : "")" @onclick="HandleRowClick">

    <td class="cq-text-align-center" @onclick:stopPropagation="true">
        <input type="checkbox"
               class="cq-checkbox"
               checked="@IsSelected"
               @onchange="HandleCheckboxChange" />
    </td>

    <td class="cq-font-monospace cq-font-bold" style="color: var(--cq-info); font-size: 0.85rem;"
        title="@Job.Id">
        @Job.Id.Substring(0, 8)...
    </td>

    <td>
        <span class="cq-badge cq-bg-light cq-text-dark cq-border cq-font-monospace">
            @Job.Queue
        </span>
    </td>

    <td>
        <span class="cq-badge cq-bg-dark cq-border cq-border-secondary cq-text-light cq-font-monospace">
            @Job.Type
        </span>
    </td>

    <td class="cq-text-align-center cq-font-bold cq-text-muted">
        @Job.Priority
    </td>

    <td>
        <span class="cq-font-bold cq-font-size-small" style="color: var(--cq-text-muted)">
            @(Job.CreatedBy ?? "System")
        </span>
    </td>

    <td>
        @if (Job.Status == JobStatus.Fetched)
        {
            <span class="cq-badge" style="background-color: #6f42c1; color: white;">FETCHED</span>
        }
        else
        {
            <span class="cq-badge @GetStatusBadgeClass()">
                @GetStatusLabel()
            </span>
        }
    </td>

    <td>
        @if (Job.Status == JobStatus.Processing)
        {
            <div class="cq-progress" style="height: 4px; background-color: var(--cq-border);">
                <div class="cq-progress-bar" role="progressbar"
                     style="width: @(Job.Progress)%; background-color: var(--cq-info);
                         transition: width 0.3s ease;">
                </div>
            </div>
            <div style="font-size: 0.7em; margin-top: 2px;">@Job.Progress%</div>
        }
        else if (Job.Status == JobStatus.Succeeded)
        {
            <div class="cq-progress" style="height: 4px; background-color: var(--cq-border);">
                <div class="cq-progress-bar" style="width: 100%; background-color: var(--cq-success);"></div>
            </div>
        }
        else
        {
            <span class="cq-text-muted">-</span>
        }
    </td>

    <td>
        @if (Job.Attempts > 1)
        {
            <span class="cq-badge" style="border: 1px solid var(--cq-border); color: var(--cq-text);">@Job.Attempts</span>
        }
        else
        {
            <span class="cq-text-muted">1</span>
        }
    </td>

    <td class="cq-font-monospace cq-font-size-small">
        @FormatDuration(Job.Duration)
    </td>

    <td class="cq-text-align-end">
        @if (Job.Status == JobStatus.Processing || Job.Status == JobStatus.Pending || Job.Status == JobStatus.Fetched)
        {
            <button class="cq-btn cq-btn-sm cq-btn-outline-danger cq-margin-right-0-5"
                    title="Stop Job"
                    @onclick="CancelJob"
                    @onclick:stopPropagation="true">
                Stop
            </button>
        }

        @if (Job.Status == JobStatus.Succeeded || Job.Status == JobStatus.Failed || Job.Status == JobStatus.Cancelled)
        {
            <button class="cq-btn cq-btn-sm cq-btn-outline-primary cq-margin-right-0-5"
                    title="Restart Job"
                    @onclick="RestartJob"
                    @onclick:stopPropagation="true">
                Retry
            </button>
        }
    </td>
</tr>

<style>
    .cq-job-row {
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .selected-row td {
        background-color: rgba(0, 120, 212, 0.1) !important;
    }
</style>